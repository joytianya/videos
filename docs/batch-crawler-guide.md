# ğŸ•·ï¸ æ‰¹é‡çˆ¬è™«ä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æ‰¹é‡çˆ¬è™«å·¥å…· (`batch-crawler.js`) ä¸“é—¨ç”¨äºå¤§è§„æ¨¡æ•°æ®çˆ¬å–ï¼Œæ”¯æŒï¼š
- **æ–­ç‚¹ç»­ä¼ **: è‡ªåŠ¨è·³è¿‡å·²å®Œæˆçš„é¡µé¢
- **è¿›åº¦ä¿å­˜**: å®æ—¶ä¿å­˜çˆ¬å–è¿›åº¦
- **å¤±è´¥é‡è¯•**: æ”¯æŒé‡è¯•å¤±è´¥çš„é¡µé¢
- **æ‰¹æ¬¡å¤„ç†**: åˆ†æ‰¹å¤„ç†ï¼Œé¿å…æœåŠ¡å™¨å‹åŠ›
- **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„çˆ¬å–æ—¥å¿—è®°å½•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. çˆ¬å–1-999é¡µæ‰€æœ‰æ•°æ®
```bash
# ä½¿ç”¨npmè„šæœ¬ï¼ˆæ¨èï¼‰
npm run batch-crawl

# æˆ–è€…ç›´æ¥è¿è¡Œ
node batch-crawler.js crawl 1 999
```

### 2. æµ‹è¯•çˆ¬å–ï¼ˆå‰10é¡µï¼‰
```bash
npm run batch-crawl-test
```

### 3. æŸ¥çœ‹çˆ¬å–è¿›åº¦
```bash
npm run batch-status
```

### 4. é‡è¯•å¤±è´¥çš„é¡µé¢
```bash
npm run batch-retry
```

## ğŸ“‹ è¯¦ç»†å‘½ä»¤è¯´æ˜

### ğŸ”„ çˆ¬å–å‘½ä»¤
```bash
# åŸºæœ¬æ ¼å¼
node batch-crawler.js crawl [èµ·å§‹é¡µ] [ç»“æŸé¡µ]

# ç¤ºä¾‹
node batch-crawler.js crawl 1 999      # çˆ¬å–1-999é¡µ
node batch-crawler.js crawl 100 200    # çˆ¬å–100-200é¡µ
node batch-crawler.js crawl 500 999    # ä»ç¬¬500é¡µå¼€å§‹çˆ¬å–åˆ°999é¡µ
```

### ğŸ“Š çŠ¶æ€æŸ¥çœ‹
```bash
node batch-crawler.js status
```
è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š çˆ¬å–è¿›åº¦:
   å½“å‰é¡µé¢: 25
   æ€»é¡µé¢æ•°: 999
   å·²å®Œæˆ: 20é¡µ
   å¤±è´¥é¡µé¢: 5é¡µ
   æœ€åæ›´æ–°: 2025-07-29T15:30:45.123Z
   çŠ¶æ€: in_progress
```

### ğŸ”„ é‡è¯•å¤±è´¥é¡µé¢
```bash
node batch-crawler.js retry
```

### ğŸ“‹ ç”Ÿæˆæ±‡æ€»æ–‡ä»¶
```bash
node batch-crawler.js summary
```

## âš™ï¸ é…ç½®å‚æ•°

åœ¨ `batch-crawler.js` ä¸­å¯ä»¥è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

```javascript
class BatchCrawler {
    constructor() {
        this.batchSize = 10;              // æ¯æ‰¹å¤„ç†é¡µé¢æ•°
        this.delayBetweenBatches = 5000;  // æ‰¹æ¬¡é—´å»¶è¿Ÿ(æ¯«ç§’)
        this.delayBetweenPages = 2000;    // é¡µé¢é—´å»¶è¿Ÿ(æ¯«ç§’)
    }
}
```

### æ¨èé…ç½®ï¼š
- **å°è§„æ¨¡æµ‹è¯•**: `batchSize: 5, delayBetweenPages: 1000`
- **æ­£å¸¸çˆ¬å–**: `batchSize: 10, delayBetweenPages: 2000` (é»˜è®¤)
- **ä¿å®ˆçˆ¬å–**: `batchSize: 5, delayBetweenPages: 5000`

## ğŸ“ è¾“å‡ºæ–‡ä»¶ç»“æ„

```
dynamic_api_data/
â”œâ”€â”€ page_001.json              # ç¬¬1é¡µæ•°æ®
â”œâ”€â”€ page_002.json              # ç¬¬2é¡µæ•°æ®
â”œâ”€â”€ ...
â”œâ”€â”€ page_999.json              # ç¬¬999é¡µæ•°æ®
â”œâ”€â”€ summary_all_videos.json    # æ‰€æœ‰è§†é¢‘æ±‡æ€»
â”œâ”€â”€ crawl_progress.json        # çˆ¬å–è¿›åº¦è®°å½•
â”œâ”€â”€ batch_crawl.log           # è¯¦ç»†çˆ¬å–æ—¥å¿—
â””â”€â”€ debug_page_X_response.json # è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
```

### æ–‡ä»¶è¯´æ˜ï¼š

#### 1. é¡µé¢æ•°æ®æ–‡ä»¶ (`page_XXX.json`)
```json
{
  "page": 1,
  "totalVideos": 36,
  "crawledAt": "2025-07-29T15:30:45.123Z",
  "apiUrl": "https://m10.yfsp.tv/api/list/Search?...",
  "videos": [
    {
      "id": "yFzkMEbsApL",
      "title": "é•¿å‘é¬¼",
      "playUrl": "https://www.yfsp.tv/play/yFzkMEbsApL",
      "categories": ["çˆ±æƒ…", "æƒŠæ‚š", "ææ€–"],
      "year": "å…¶å®ƒ",
      "rating": "æš‚æ— è¯„åˆ†",
      "views": "867",
      "addTime": "2025å¹´07æœˆ29æ—¥"
    }
  ]
}
```

#### 2. æ±‡æ€»æ–‡ä»¶ (`summary_all_videos.json`)
```json
{
  "totalPages": 25,
  "totalVideos": 900,
  "generatedAt": "2025-07-29T15:30:45.123Z",
  "pageRange": {
    "min": 1,
    "max": 25
  },
  "videos": [/* æ‰€æœ‰è§†é¢‘æ•°æ® */]
}
```

#### 3. è¿›åº¦æ–‡ä»¶ (`crawl_progress.json`)
```json
{
  "currentPage": 25,
  "totalPages": 999,
  "completedPages": 20,
  "failedPages": 5,
  "completedList": [1, 2, 3, 5, 7, ...],
  "failedList": [4, 6, 8, 12, 15],
  "lastUpdate": "2025-07-29T15:30:45.123Z",
  "status": "in_progress"
}
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### 1. å®æ—¶ç›‘æ§æ—¥å¿—
```bash
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f dynamic_api_data/batch_crawl.log
```

### 2. æ£€æŸ¥å·²å®Œæˆé¡µé¢
```bash
ls dynamic_api_data/page_*.json | wc -l
```

### 3. æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆæ’é™¤å¼‚å¸¸å°çš„æ–‡ä»¶ï¼‰
```bash
find dynamic_api_data -name "page_*.json" -size +1k | wc -l
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç½‘ç»œç¨³å®šæ€§
- ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š
- å¦‚æœç½‘ç»œä¸ç¨³å®šï¼Œå»ºè®®å¢åŠ å»¶è¿Ÿæ—¶é—´

### 2. æœåŠ¡å™¨è´Ÿè½½
- ä¸è¦è®¾ç½®è¿‡å°çš„å»¶è¿Ÿæ—¶é—´
- æ¨èé¡µé¢é—´å»¶è¿Ÿè‡³å°‘2ç§’

### 3. ç£ç›˜ç©ºé—´
- 999é¡µæ•°æ®å¤§çº¦éœ€è¦50-100MBç©ºé—´
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´

### 4. ä¸­æ–­å’Œæ¢å¤
- å¯ä»¥éšæ—¶ä¸­æ–­çˆ¬å–ï¼ˆCtrl+Cï¼‰
- é‡æ–°è¿è¡Œæ—¶ä¼šè‡ªåŠ¨ä»æ–­ç‚¹ç»§ç»­

## ğŸš¨ æ•…éšœæ’é™¤

### 1. é¡µé¢çˆ¬å–å¤±è´¥
```bash
# æŸ¥çœ‹å¤±è´¥é¡µé¢
npm run batch-status

# é‡è¯•å¤±è´¥é¡µé¢
npm run batch-retry
```

### 2. APIå‚æ•°è·å–å¤±è´¥
- é€šå¸¸æ˜¯ç½‘ç»œé—®é¢˜æˆ–ç›®æ ‡ç½‘ç«™ä¸´æ—¶ä¸å¯ç”¨
- ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•

### 3. æ–‡ä»¶æŸå
```bash
# æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
find dynamic_api_data -name "page_*.json" -size -1k

# åˆ é™¤æŸåçš„æ–‡ä»¶ï¼ˆä¼šè‡ªåŠ¨é‡æ–°çˆ¬å–ï¼‰
find dynamic_api_data -name "page_*.json" -size -1k -delete
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶å‘æ§åˆ¶
å½“å‰ç‰ˆæœ¬ä¸ºä¸²è¡Œå¤„ç†ï¼Œå¦‚éœ€æé«˜é€Ÿåº¦å¯ä»¥ï¼š
- å‡å°‘å»¶è¿Ÿæ—¶é—´ï¼ˆé£é™©ï¼šå¯èƒ½è¢«å°IPï¼‰
- å¢åŠ æ‰¹æ¬¡å¤§å°

### 2. å†…å­˜ä¼˜åŒ–
- å¤§æ‰¹é‡çˆ¬å–æ—¶ï¼Œå»ºè®®å®šæœŸé‡å¯ç¨‹åº
- æ¯100é¡µé‡æ–°ç”Ÿæˆä¸€æ¬¡æ±‡æ€»æ–‡ä»¶

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. å®Œæ•´æ•°æ®çˆ¬å–
```bash
# çˆ¬å–æ‰€æœ‰é¡µé¢
npm run batch-crawl
```

### 2. å¢é‡æ›´æ–°
```bash
# å‡è®¾å·²æœ‰1-500é¡µï¼Œç°åœ¨çˆ¬å–501-999é¡µ
node batch-crawler.js crawl 501 999
```

### 3. ç‰¹å®šèŒƒå›´çˆ¬å–
```bash
# åªçˆ¬å–æœ€æ–°çš„100é¡µ
node batch-crawler.js crawl 900 999
```

## ğŸ”„ ä¸æœç´¢ç³»ç»Ÿé›†æˆ

çˆ¬å–å®Œæˆåï¼Œéœ€è¦é‡å»ºæœç´¢ç´¢å¼•ï¼š

```bash
# é‡å»ºæœç´¢ç´¢å¼•
npm run build-index

# æµ‹è¯•æœç´¢åŠŸèƒ½
npm run test-search
```

---

**å¼€å§‹ä½ çš„å¤§è§„æ¨¡æ•°æ®çˆ¬å–ä¹‹æ—…ï¼** ğŸš€

è®°ä½ï¼š**è€å¿ƒæ˜¯çˆ¬è™«çš„ç¾å¾·ï¼Œç¨³å®šæ¯”é€Ÿåº¦æ›´é‡è¦ï¼** â°âœ¨ 
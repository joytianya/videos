# 🔍 视频搜索系统使用指南

## 🎯 系统概述

这个视频搜索系统整合了视频爬取、搜索索引构建和播放功能，提供了完整的视频搜索和播放体验。

## 🚀 快速开始

### 1. 启动服务器
```bash
npm start
```

### 2. 访问搜索页面
打开浏览器访问：`http://localhost:3000/search.html`

## 📋 功能特性

### ✅ 已实现功能

1. **智能搜索**
   - 支持中文分词搜索
   - 模糊匹配和相关性排序
   - 实时搜索建议

2. **视频信息展示**
   - 标题、分类、评分
   - 年份、语言、地区
   - 简介、热度等元信息

3. **一键播放**
   - 自动提取M3U8播放地址
   - 支持HLS视频流播放
   - 跨域代理播放

4. **详细信息查看**
   - 弹窗显示完整视频信息
   - 包含导演、主演、简介等

## 🛠️ 系统架构

### 核心组件

1. **动态API爬虫** (`dynamic-api-crawler.js`)
   - 自动获取API签名参数
   - 爬取视频数据并保存到JSON文件

2. **搜索索引构建器** (`search-index.js`)
   - 从爬取的数据构建搜索索引
   - 支持中文分词和相关性计算

3. **代理服务器** (`proxy-server.js`)
   - 提供搜索API接口
   - 代理视频流播放
   - 自动提取M3U8地址

4. **前端界面**
   - `search.html` - 搜索页面
   - `player.html` - 播放器页面

### 数据流程

```
1. 爬虫获取数据 → dynamic_api_data/*.json
2. 构建搜索索引 → video_search_index.json  
3. 用户搜索 → 搜索API → 返回结果
4. 点击播放 → 提取M3U8 → 代理播放
```

## 📊 数据统计

当前系统包含：
- **180个视频** (来自5页数据)
- **2474个搜索关键词**
- **支持的分类**: 剧情、爱情、惊悚、恐怖、喜剧等

## 🔧 API接口

### 搜索API
```http
GET /search?q=关键词&limit=3
```

**响应示例**：
```json
{
  "success": true,
  "query": "长发",
  "results": [
    {
      "title": "长发鬼",
      "categories": ["爱情", "惊悚", "恐怖"],
      "playUrl": "https://www.yfsp.tv/play/yFzkMEbsApL",
      "searchScore": 220,
      "year": 2025,
      "rating": "6.0"
    }
  ],
  "total": 1
}
```

### 视频详情API
```http
GET /video/{videoId}
```

### 搜索统计API
```http
GET /search-stats
```

### M3U8提取API
```http
POST /extract-url
Content-Type: application/json

{
  "pageUrl": "https://www.yfsp.tv/play/xxxxx"
}
```

## 🎮 使用方法

### 1. 搜索视频
1. 在搜索框输入关键词（如"长发"、"爱情"等）
2. 系统会实时显示相关结果
3. 每个结果显示匹配度得分

### 2. 查看详情
- 点击"详细信息"按钮查看完整视频信息
- 包含导演、主演、简介等详细内容

### 3. 播放视频
1. 点击"立即播放"按钮
2. 系统自动提取M3U8播放地址
3. 在新窗口中打开播放器
4. 支持全屏播放和视频信息显示

## 🔄 数据更新

### 爬取更多数据
```bash
# 爬取所有页面（最多1000页）
npm run dynamic-api-crawl-all

# 重新构建搜索索引
npm run build-index
```

### 测试搜索功能
```bash
npm run test-search
```

## 🎨 界面特性

- **现代化设计**: 渐变背景、卡片式布局
- **响应式设计**: 适配手机和桌面设备
- **实时搜索**: 输入时自动搜索（防抖处理）
- **加载动画**: 搜索和播放时的加载提示
- **错误处理**: 友好的错误提示和重试机制

## 🚧 扩展功能

### 可以添加的功能：
1. **高级搜索**: 按分类、年份、评分筛选
2. **收藏功能**: 用户收藏喜欢的视频
3. **播放历史**: 记录用户观看历史
4. **推荐系统**: 基于用户行为推荐视频
5. **评论系统**: 用户评论和评分

## 🐛 故障排除

### 常见问题

1. **搜索无结果**
   - 检查搜索索引是否构建：`npm run build-index`
   - 确认数据文件存在：`ls dynamic_api_data/`

2. **播放失败**
   - 检查代理服务器是否运行
   - 查看浏览器控制台错误信息
   - 确认网络连接正常

3. **服务器启动失败**
   - 检查端口3000是否被占用
   - 确认所有依赖已安装：`npm install`

### 调试模式
服务器会在控制台输出详细日志，包括：
- 搜索请求和结果
- M3U8提取过程
- 代理请求状态

## 📈 性能优化

- **搜索索引**: 预构建索引，搜索响应速度快
- **视频代理**: 流式传输，支持大文件播放
- **前端缓存**: 合理使用浏览器缓存
- **错误重试**: 自动重试机制提高成功率

## 🔐 安全考虑

- **CORS处理**: 正确设置跨域头
- **输入验证**: 防止恶意输入
- **资源限制**: 限制搜索结果数量
- **代理安全**: 仅代理特定域名的请求

---

**享受你的视频搜索和播放体验！** 🎬✨ 
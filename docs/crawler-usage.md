# 🕷️ 视频爬虫使用指南

## 功能介绍

这个智能爬虫程序能够自动抓取 [https://www.yfsp.tv/list](https://www.yfsp.tv/list) 网站上的所有视频信息，包括：

### 📋 抓取的信息
- **🎬 视频标题**：完整的视频名称
- **📝 视频描述**：详细的视频简介
- **🔗 播放地址**：M3U8 视频流地址
- **🖼️ 缩略图**：视频封面图片
- **⭐ 评分**：用户评分信息
- **👁️ 播放次数**：观看统计
- **⏱️ 视频时长**：播放时长
- **📅 发布日期**：上传时间
- **🏷️ 标签分类**：视频分类标签
- **💬 评论数量**：评论统计

## 🚀 快速开始

### 1. 测试运行（推荐）
```bash
# 爬取前3页进行测试
npm run crawl-test
```

### 2. 标准运行
```bash
# 从第1页开始爬取，默认最多50页
npm run crawl
```

### 3. 完整爬取
```bash
# 爬取前100页的所有视频
npm run crawl-all
```

### 4. 自定义参数
```bash
# 从第5页开始，最多爬取20页
node crawler.js 5 20
```

## 📊 输出文件

### JSON 数据文件
- **文件名格式**：`videos_2024-01-15T14-30-00.json`
- **内容结构**：
```json
{
  "crawlInfo": {
    "totalVideos": 150,
    "successCount": 142,
    "failureCount": 8,
    "crawledAt": "2024-01-15T14:30:00.000Z",
    "baseUrl": "https://www.yfsp.tv/list"
  },
  "videos": [
    {
      "url": "https://www.yfsp.tv/play/6T3bzwMGODG",
      "title": "示例视频标题",
      "thumbnail": "https://www.yfsp.tv/thumb/example.jpg",
      "description": "视频详细描述...",
      "rating": "8.5",
      "views": "1000次播放",
      "duration": "45:30",
      "publishDate": "2024-01-10",
      "tags": ["动作", "冒险"],
      "m3u8Urls": [
        "https://example.com/video.m3u8"
      ],
      "success": true,
      "crawledAt": "2024-01-15T14:30:00.000Z"
    }
  ]
}
```

### 统计报告文件
- **文件名格式**：`crawler_report_2024-01-15T14-30-00.txt`
- **包含内容**：
  - 总视频数量统计
  - 成功/失败比例
  - 有播放地址的视频数量
  - 完成时间等信息

## ⚙️ 高级配置

### 修改爬取参数
编辑 `crawler.js` 文件中的配置：

```javascript
class VideoListCrawler {
    constructor() {
        this.baseUrl = 'https://www.yfsp.tv/list';
        this.maxRetries = 3;        // 重试次数
        this.delay = 2000;          // 请求间隔(毫秒)
    }
}
```

### 自定义选择器
如果网站结构发生变化，可以修改选择器数组：

```javascript
// 视频链接选择器
const selectors = [
    'a[href*="/play/"]',
    '.video-item a',
    '.video-list a',
    // 添加新的选择器...
];
```

## 🛡️ 安全特性

- **智能延迟**：自动在请求间添加延迟，避免过于频繁的访问
- **重试机制**：失败的请求会自动重试最多3次
- **错误处理**：完善的异常处理，确保程序稳定运行
- **数据备份**：每处理10个视频自动保存临时文件，防止数据丢失

## 📝 使用注意事项

1. **网络环境**：确保网络连接稳定
2. **存储空间**：预留足够的磁盘空间存储结果文件
3. **运行时间**：完整爬取可能需要较长时间，建议先用测试模式
4. **合规使用**：请遵守网站的使用条款和相关法律法规

## 🔧 故障排除

### 常见问题

**Q: 爬虫运行缓慢？**
A: 这是正常现象，为了避免对服务器造成压力，程序会在请求间添加延迟。

**Q: 部分视频获取失败？**
A: 可能是网络问题或页面结构变化，程序会自动重试并在报告中统计失败数量。

**Q: 如何停止正在运行的爬虫？**
A: 在终端中按 `Ctrl + C` 即可停止程序。

**Q: 生成的JSON文件很大？**
A: 这是正常的，大量视频信息会产生较大的文件。可以使用JSON查看器或文本编辑器打开。

## 📈 性能优化建议

1. **分批处理**：对于大量页面，建议分批次运行
2. **定期清理**：及时清理临时文件和旧的结果文件
3. **监控资源**：注意系统内存和CPU使用情况

## 🤝 技术支持

如有问题或建议，请查看程序运行日志中的详细错误信息，或联系开发者获取支持。 